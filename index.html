<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>linkTalk - AAK Kommunik√°ci√≥s Alkalmaz√°s</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom colors for Fitzgerald Key system */
        .noun-bg { background-color: #FFD700; color: black; }
        .verb-bg { background-color: #32CD32; color: white; }
        .adjective-bg { background-color: #4169E1; color: white; }
        .social-bg { background-color: #FF69B4; color: black; }
        
        /* High contrast and accessibility improvements */
        .communication-button {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 3px solid transparent;
        }
        
        .communication-button:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border-color: #333;
        }
        
        .communication-button:active {
            transform: scale(0.95);
        }
        
        .sentence-item {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Ensure text is always readable on placeholder images */
        .image-text-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px;
            font-weight: bold;
            text-align: center;
            font-size: 0.875rem;
        }
        
        /* Custom scrollbar for sentence bar */
        .sentence-scroll::-webkit-scrollbar {
            height: 8px;
        }
        
        .sentence-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .sentence-scroll::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .sentence-scroll::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Main Container -->
    <div class="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50">
        <!-- Header -->
        <header class="bg-white shadow-lg p-4">
            <div class="max-w-7xl mx-auto">
                <h1 class="text-3xl font-bold text-center text-blue-600 mb-2">
                    üó£Ô∏è linkTalk
                </h1>
                <p class="text-center text-gray-600 text-sm">
                    √ârintsd, √âp√≠tsd, Besz√©lj - A Te Hangod Sz√°m√≠t
                </p>
            </div>
        </header>

        <!-- Sentence Assembly Bar -->
        <section class="bg-white shadow-md p-4 mx-4 mt-4 rounded-lg">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center gap-4">
                    <!-- Sentence Display Area -->
                    <div class="flex-1 min-h-[80px] bg-gray-50 border-2 border-gray-300 rounded-lg p-3 sentence-scroll overflow-x-auto">
                        <div id="sentence-display" class="flex items-center gap-2 min-h-[60px]">
                            <span class="text-gray-500 italic" id="placeholder-text">
                                √ârintsd meg a szavakat a mondat fel√©p√≠t√©s√©hez...
                            </span>
                        </div>
                    </div>
                    
                    <!-- Control Buttons -->
                    <div class="flex flex-col gap-2">
                        <button id="play-button" 
                                class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed"
                                disabled>
                            ‚ñ∂Ô∏è LEJ√ÅTSZ√ÅS
                        </button>
                        <button id="clear-button" 
                                class="bg-red-500 hover:bg-red-600 text-white p-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105">
                            üóëÔ∏è T√ñRL√âS
                        </button>
                    </div>
                </div>
                
                <!-- Sentence Text Preview -->
                <div class="mt-3 p-2 bg-blue-50 rounded text-center">
                    <span id="sentence-text" class="text-lg font-medium text-blue-800">
                        <!-- Built sentence will appear here -->
                    </span>
                </div>
            </div>
        </section>

        <!-- Category Navigation -->
        <nav class="p-4">
            <div class="max-w-7xl mx-auto">
                <div class="flex flex-wrap gap-2 justify-center">
                    <button class="category-btn bg-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-all" 
                            data-category="core">
                        ‚≠ê Alapszavak
                    </button>
                    <button class="category-btn bg-purple-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-600 transition-all" 
                            data-category="food">
                        üçé √âtel
                    </button>
                    <button class="category-btn bg-orange-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-orange-600 transition-all" 
                            data-category="activities">
                        üéÆ Tev√©kenys√©gek
                    </button>
                    <button class="category-btn bg-pink-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-pink-600 transition-all" 
                            data-category="feelings">
                        üòä √ârz√©sek
                    </button>
                </div>
            </div>
        </nav>

        <!-- Communication Grid -->
        <main class="p-4">
            <div class="max-w-7xl mx-auto">
                <div id="communication-grid" 
                     class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <!-- Communication buttons will be dynamically generated here -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white shadow-lg mt-8 p-4 text-center text-gray-600">
            <p>Akad√°lymentes√≠tett kommunik√°ci√≥hoz tervezve ‚Ä¢ Webes besz√©dszint√©zis enged√©lyezve</p>
        </footer>
    </div>

    <script>
        // Sz√≥k√©szlet adatstrukt√∫ra Fitzgerald kulcs sz√≠nk√≥dol√°ssal
        const vocabulary = {
            core: [
                // F≈ënevek (S√°rga h√°tt√©r)
                { id: 'i', label: '√©n', category: 'core', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=√âN' },
                { id: 'you', label: 'te', category: 'core', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=TE' },
                { id: 'mom', label: 'anya', category: 'core', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=ANYA' },
                { id: 'dad', label: 'apa', category: 'core', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=APA' },
                { id: 'help', label: 'seg√≠ts√©g', category: 'core', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=SEG√çTS√âG' },
                { id: 'more', label: 't√∂bb', category: 'core', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=T√ñBB' },
                
                // Ig√©k (Z√∂ld h√°tt√©r)
                { id: 'want', label: 'akarok', category: 'core', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=AKAROK' },
                { id: 'need', label: 'kell', category: 'core', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=KELL' },
                { id: 'go', label: 'megyek', category: 'core', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=MEGYEK' },
                { id: 'stop', label: '√°llj', category: 'core', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=√ÅLLJ' },
                { id: 'like', label: 'szeretem', category: 'core', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=SZERETEM' },
                { id: 'have', label: 'van', category: 'core', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=VAN' },
                
                // T√°rsas√°gi/Cseveg≈ë szavak (R√≥zsasz√≠n h√°tt√©r)
                { id: 'please', label: 'k√©rem', category: 'core', grammaticalType: 'social', imageURL: 'https://placehold.co/150x150/FF69B4/000000?text=K√âREM' },
                { id: 'thank-you', label: 'k√∂sz√∂n√∂m', category: 'core', grammaticalType: 'social', imageURL: 'https://placehold.co/150x150/FF69B4/000000?text=K√ñSZ√ñN√ñM' },
                { id: 'hello', label: 'szia', category: 'core', grammaticalType: 'social', imageURL: 'https://placehold.co/150x150/FF69B4/000000?text=SZIA' },
                { id: 'bye', label: 'viszl√°t', category: 'core', grammaticalType: 'social', imageURL: 'https://placehold.co/150x150/FF69B4/000000?text=VISZL√ÅT' },
                { id: 'sorry', label: 'sajn√°lom', category: 'core', grammaticalType: 'social', imageURL: 'https://placehold.co/150x150/FF69B4/000000?text=SAJN√ÅLOM' },
                { id: 'yes', label: 'igen', category: 'core', grammaticalType: 'social', imageURL: 'https://placehold.co/150x150/FF69B4/000000?text=IGEN' },
                { id: 'no', label: 'nem', category: 'core', grammaticalType: 'social', imageURL: 'https://placehold.co/150x150/FF69B4/000000?text=NEM' }
            ],
            
            food: [
                // √âtel f≈ënevek (S√°rga h√°tt√©r)
                { id: 'apple', label: 'alma', category: 'food', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=ALMA' },
                { id: 'banana', label: 'ban√°n', category: 'food', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=BAN√ÅN' },
                { id: 'water', label: 'v√≠z', category: 'food', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=V√çZ' },
                { id: 'milk', label: 'tej', category: 'food', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=TEJ' },
                { id: 'bread', label: 'keny√©r', category: 'food', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=KENY√âR' },
                { id: 'cookie', label: 's√ºti', category: 'food', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=S√úTI' },
                { id: 'pizza', label: 'pizza', category: 'food', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=PIZZA' },
                { id: 'juice', label: 'l√©', category: 'food', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=L√â' },
                
                // √âtel ig√©k (Z√∂ld h√°tt√©r)
                { id: 'eat', label: 'eszek', category: 'food', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=ESZEK' },
                { id: 'drink', label: 'iszok', category: 'food', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=ISZOK' },
                { id: 'taste', label: 'k√≥stolok', category: 'food', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=K√ìSTOLOK' },
                { id: 'cook', label: 'f≈ëz√∂k', category: 'food', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=F≈êZ√ñK' },
                
                // √âtel mell√©knevek (K√©k h√°tt√©r)
                { id: 'hungry', label: '√©hes', category: 'food', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=√âHES' },
                { id: 'thirsty', label: 'szomjas', category: 'food', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=SZOMJAS' },
                { id: 'yummy', label: 'finom', category: 'food', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=FINOM' },
                { id: 'hot', label: 'forr√≥', category: 'food', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=FORR√ì' },
                { id: 'cold', label: 'hideg', category: 'food', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=HIDEG' }
            ],
            
            activities: [
                // Tev√©kenys√©g f≈ënevek (S√°rga h√°tt√©r)
                { id: 'book', label: 'k√∂nyv', category: 'activities', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=K√ñNYV' },
                { id: 'toy', label: 'j√°t√©k', category: 'activities', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=J√ÅT√âK' },
                { id: 'game', label: 'j√°t√©k', category: 'activities', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=J√ÅT√âK' },
                { id: 'music', label: 'zene', category: 'activities', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=ZENE' },
                { id: 'movie', label: 'film', category: 'activities', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=FILM' },
                { id: 'park', label: 'park', category: 'activities', grammaticalType: 'noun', imageURL: 'https://placehold.co/150x150/FFD700/000000?text=PARK' },
                
                // Tev√©kenys√©g ig√©k (Z√∂ld h√°tt√©r)
                { id: 'play', label: 'j√°tszom', category: 'activities', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=J√ÅTSZOM' },
                { id: 'read', label: 'olvasok', category: 'activities', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=OLVASOK' },
                { id: 'watch', label: 'n√©zek', category: 'activities', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=N√âZEK' },
                { id: 'listen', label: 'hallgatom', category: 'activities', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=HALLGATOM' },
                { id: 'run', label: 'futok', category: 'activities', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=FUTOK' },
                { id: 'jump', label: 'ugrok', category: 'activities', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=UGROK' },
                { id: 'sing', label: '√©nekelek', category: 'activities', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=√âNEKELEK' },
                { id: 'dance', label: 't√°ncolok', category: 'activities', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=T√ÅNCOLOK' },
                
                // Tev√©kenys√©g mell√©knevek (K√©k h√°tt√©r)
                { id: 'fun', label: 'sz√≥rakoztat√≥', category: 'activities', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=SZ√ìRAKOZTAT√ì' },
                { id: 'boring', label: 'unalmas', category: 'activities', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=UNALMAS' },
                { id: 'fast', label: 'gyors', category: 'activities', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=GYORS' },
                { id: 'slow', label: 'lass√∫', category: 'activities', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=LASS√ö' }
            ],
            
            feelings: [
                // √ârz√©s mell√©knevek (K√©k h√°tt√©r)
                { id: 'happy', label: 'boldog', category: 'feelings', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=BOLDOG' },
                { id: 'sad', label: 'szomor√∫', category: 'feelings', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=SZOMOR√ö' },
                { id: 'angry', label: 'm√©rges', category: 'feelings', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=M√âRGES' },
                { id: 'scared', label: 'f√©lek', category: 'feelings', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=F√âLEK' },
                { id: 'excited', label: 'izgatott', category: 'feelings', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=IZGATOTT' },
                { id: 'tired', label: 'f√°radt', category: 'feelings', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=F√ÅRADT' },
                { id: 'sick', label: 'beteg', category: 'feelings', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=BETEG' },
                { id: 'good', label: 'j√≥', category: 'feelings', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=J√ì' },
                { id: 'bad', label: 'rossz', category: 'feelings', grammaticalType: 'adjective', imageURL: 'https://placehold.co/150x150/4169E1/FFFFFF?text=ROSSZ' },
                
                // √ârz√©s ig√©k (Z√∂ld h√°tt√©r)
                { id: 'feel', label: '√©rzem', category: 'feelings', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=√âRZEM' },
                { id: 'love', label: 'szeretem', category: 'feelings', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=SZERETEM' },
                { id: 'hate', label: 'ut√°lom', category: 'feelings', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=UT√ÅLOM' },
                { id: 'worry', label: 'agg√≥dom', category: 'feelings', grammaticalType: 'verb', imageURL: 'https://placehold.co/150x150/32CD32/FFFFFF?text=AGG√ìDOM' },
                
                // T√°rsas√°gi kifejez√©sek √©rz√©sekhez (R√≥zsasz√≠n h√°tt√©r)
                { id: 'help-me', label: 'seg√≠ts', category: 'feelings', grammaticalType: 'social', imageURL: 'https://placehold.co/150x150/FF69B4/000000?text=SEG√çTS' },
                { id: 'hug', label: '√∂lel√©s', category: 'feelings', grammaticalType: 'social', imageURL: 'https://placehold.co/150x150/FF69B4/000000?text=√ñLEL√âS' },
                { id: 'comfort', label: 'vigasz', category: 'feelings', grammaticalType: 'social', imageURL: 'https://placehold.co/150x150/FF69B4/000000?text=VIGASZ' }
            ]
        };

        // Application State
        let currentCategory = 'core';
        let sentence = [];
        let speechSynthesis = window.speechSynthesis;

        // DOM Elements
        const sentenceDisplay = document.getElementById('sentence-display');
        const sentenceText = document.getElementById('sentence-text');
        const placeholderText = document.getElementById('placeholder-text');
        const playButton = document.getElementById('play-button');
        const clearButton = document.getElementById('clear-button');
        const communicationGrid = document.getElementById('communication-grid');
        const categoryButtons = document.querySelectorAll('.category-btn');

        // Initialize the application
        function init() {
            setupEventListeners();
            loadCategory('core');
            updateSentenceDisplay();
        }

        // Event Listeners
        function setupEventListeners() {
            // Category navigation
            categoryButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const category = e.target.dataset.category;
                    loadCategory(category);
                    updateActiveCategory(btn);
                });
            });

            // Control buttons
            playButton.addEventListener('click', speakSentence);
            clearButton.addEventListener('click', clearSentence);

            // Keyboard support
            document.addEventListener('keydown', handleKeyboard);
        }

        // Load vocabulary for a specific category
        function loadCategory(category) {
            currentCategory = category;
            const words = vocabulary[category] || [];
            
            communicationGrid.innerHTML = '';
            
            words.forEach(word => {
                const button = createCommunicationButton(word);
                communicationGrid.appendChild(button);
            });
        }

        // Create a communication button
        function createCommunicationButton(word) {
            const button = document.createElement('button');
            button.className = `communication-button w-full aspect-square rounded-lg shadow-lg flex flex-col items-center justify-center text-center p-2 ${getGrammaticalTypeClass(word.grammaticalType)} focus:outline-none focus:ring-4 focus:ring-blue-300`;
            
            button.innerHTML = `
                <div class="relative w-full h-24 mb-2 rounded overflow-hidden">
                    <img src="${word.imageURL}" 
                         alt="${word.label}" 
                         class="w-full h-full object-cover"
                         loading="lazy">
                </div>
                <span class="font-bold text-sm uppercase tracking-wide">
                    ${word.label}
                </span>
            `;
            
            // Single click: speak individual word and add to sentence
            button.addEventListener('click', () => {
                speakWord(word.label);
                addToSentence(word);
            });
            
            return button;
        }

        // Get CSS class for grammatical type (Fitzgerald Key)
        function getGrammaticalTypeClass(type) {
            switch(type) {
                case 'noun': return 'noun-bg';
                case 'verb': return 'verb-bg';
                case 'adjective': return 'adjective-bg';
                case 'social': return 'social-bg';
                default: return 'bg-gray-200 text-gray-800';
            }
        }

        // Add word to sentence
        function addToSentence(word) {
            sentence.push(word);
            updateSentenceDisplay();
        }

        // Update sentence display
        function updateSentenceDisplay() {
            if (sentence.length === 0) {
                sentenceDisplay.innerHTML = '<span class="text-gray-500 italic" id="placeholder-text">√ârintsd meg a szavakat a mondat fel√©p√≠t√©s√©hez...</span>';
                sentenceText.textContent = '';
                playButton.disabled = true;
            } else {
                // Hide placeholder text
                const placeholder = document.getElementById('placeholder-text');
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
                
                // Create sentence items
                sentenceDisplay.innerHTML = sentence.map((word, index) => `
                    <div class="sentence-item flex flex-col items-center p-2 bg-white rounded-lg shadow-sm border-2 ${getGrammaticalTypeClass(word.grammaticalType)} min-w-[80px]">
                        <img src="${word.imageURL}" 
                             alt="${word.label}" 
                             class="w-12 h-12 object-cover rounded mb-1">
                        <span class="text-xs font-semibold text-center">${word.label}</span>
                        <button class="remove-word mt-1 text-red-500 hover:text-red-700 text-xs" 
                                onclick="removeFromSentence(${index})" 
                                title="Remove word">
                            ‚úï
                        </button>
                    </div>
                `).join('');
                
                // Update sentence text
                const sentenceString = sentence.map(word => word.label).join(' ');
                sentenceText.textContent = sentenceString;
                playButton.disabled = false;
            }
        }

        // Remove word from sentence
        function removeFromSentence(index) {
            sentence.splice(index, 1);
            updateSentenceDisplay();
        }

        // Clear entire sentence
        function clearSentence() {
            sentence = [];
            updateSentenceDisplay();
        }

        // Text-to-Speech functionality
        function speakWord(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.8;
                utterance.pitch = 1.1;
                utterance.volume = 1.0;
                
                speechSynthesis.speak(utterance);
            } else {
                console.warn('Speech synthesis not supported');
                alert('Speech synthesis is not supported in your browser.');
            }
        }

        // Speak entire sentence
        function speakSentence() {
            if (sentence.length === 0) return;
            
            const sentenceString = sentence.map(word => word.label).join(' ');
            speakWord(sentenceString);
        }

        // Update active category button
        function updateActiveCategory(activeBtn) {
            categoryButtons.forEach(btn => {
                btn.classList.remove('bg-blue-700', 'bg-purple-700', 'bg-orange-700', 'bg-pink-700');
                btn.classList.add('bg-blue-500', 'bg-purple-500', 'bg-orange-500', 'bg-pink-500');
            });
            
            const category = activeBtn.dataset.category;
            switch(category) {
                case 'core':
                    activeBtn.classList.remove('bg-blue-500');
                    activeBtn.classList.add('bg-blue-700');
                    break;
                case 'food':
                    activeBtn.classList.remove('bg-purple-500');
                    activeBtn.classList.add('bg-purple-700');
                    break;
                case 'activities':
                    activeBtn.classList.remove('bg-orange-500');
                    activeBtn.classList.add('bg-orange-700');
                    break;
                case 'feelings':
                    activeBtn.classList.remove('bg-pink-500');
                    activeBtn.classList.add('bg-pink-700');
                    break;
            }
        }

        // Keyboard support
        function handleKeyboard(e) {
            switch(e.key) {
                case 'Enter':
                case ' ':
                    if (!playButton.disabled) {
                        e.preventDefault();
                        speakSentence();
                    }
                    break;
                case 'Escape':
                case 'Delete':
                case 'Backspace':
                    e.preventDefault();
                    if (e.shiftKey) {
                        clearSentence();
                    } else if (sentence.length > 0) {
                        removeFromSentence(sentence.length - 1);
                    }
                    break;
                case '1':
                    loadCategory('core');
                    break;
                case '2':
                    loadCategory('food');
                    break;
                case '3':
                    loadCategory('activities');
                    break;
                case '4':
                    loadCategory('feelings');
                    break;
            }
        }

        // Make removeFromSentence globally available
        window.removeFromSentence = removeFromSentence;

        // Start the application
        document.addEventListener('DOMContentLoaded', init);

        // Handle speech synthesis voice loading
        if ('speechSynthesis' in window) {
            // Ensure voices are loaded
            speechSynthesis.onvoiceschanged = function() {
                // Voices are now available
                console.log('Speech synthesis voices loaded');
            };
        }
    </script>
</body>
</html>